
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>9: Adaptive methods. &#8212; MATH 263: Numerical differential equations</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '09-adaptive_methods';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10: Boundary value problems and the shooting method." href="10-shooting_method.html" />
    <link rel="prev" title="8: Higher order initial value problems." href="08-higher_order_odes.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="00-intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/gcc_seal.png" class="logo__image only-light" alt="MATH 263: Numerical differential equations - Home"/>
    <img src="_static/gcc_seal.png" class="logo__image only-dark pst-js-only" alt="MATH 263: Numerical differential equations - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="00-intro.html">
                    MATH 263: Numerical differential equations.
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01-direction_fields.html">1: Direction fields.</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-euler_method.html">2: Euler’s method.</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-error_analysis.html">3: Error analysis.</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-runge-kutta_methods.html">4: Runge–Kutta methods.</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-multistep_methods.html">5: Multistep methods.</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-predictor-corrector_methods.html">6: Predictor–corrector methods.</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-systems_of_odes.html">7: Systems of first order ODE’s.</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-higher_order_odes.html">8: Higher order initial value problems.</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">9: Adaptive methods.</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-shooting_method.html">10: Boundary value problems and the shooting method.</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-finite_differences.html">11: Finite difference methods for boundary value problems.</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-stiffness.html">12: Stiffness.</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ethancsmith/math263-notes" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ethancsmith/math263-notes/issues/new?title=Issue%20on%20page%20%2F09-adaptive_methods.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/09-adaptive_methods.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>9: Adaptive methods.</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-unknown">Estimating the unknown.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-error">Controlling error.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-and-disadvantages">Advantages and disadvantages.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rungekuttafehlberg-and-dormandprince">Runge–Kutta–Fehlberg and Dormand–Prince.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example.</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="adaptive-methods">
<h1>9: Adaptive methods.<a class="headerlink" href="#adaptive-methods" title="Link to this heading">#</a></h1>
<p>Up to this point, our methods have operated with a fixed step-size <span class="math notranslate nohighlight">\(h\)</span>.
<strong>Adaptive methods</strong> incorporate a procedure to adjust the step-size in an attempt to keep the truncation error under control.
When we use numerical methods in practice, however, we typically cannot solve for the true solution exactly, and so it is impossible to compute the error.
Adaptive methods, therefore, incorporate some procedure to estimate the local truncation error at each step.</p>
<section id="estimating-the-unknown">
<h2>Estimating the unknown.<a class="headerlink" href="#estimating-the-unknown" title="Link to this heading">#</a></h2>
<p>Here we give a description of how adaptive methods estimate local truncation error – something that is typically unknowable.
As we will see, the basic idea is to use a second numerical method of one higher order of accuracy.
Suppose that we have 2 methods for numerically integrating an ODE.
For simplicity, we assume that both are single step methods.
We assume that the first method takes the form</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
y_{i+1} = y_i + h\phi_1(x_i, y_i, h),
\end{equation*}\]</div>
<p>while the second takes the form</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\hat{y_{i+1}} = \hat{y_i} + h\phi_2(x_i,\hat{y_i}, h).
\end{equation*}\]</div>
<p>Furthermore, we assume that the first method has local truncation error <span class="math notranslate nohighlight">\(l_{i+1}=O(h^{p+1})\)</span>  while the second is <span class="math notranslate nohighlight">\(\hat{l_{i+1}}=O(h^{p+2})\)</span>, i.e., if <span class="math notranslate nohighlight">\(y\)</span> is the true solution, then we have</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
y(x_{i+1}) &amp;= y(x_i) + h\phi_1(x_i, y(x_i), h) + O(h^{p+1}),\\
y(x_{i+1}) &amp;= y(x_i) + h\phi_2(x_i, y(x_i), h) + O(h^{p+2}).
\end{align*}\]</div>
<p>Since we are interested in the local truncation error, we assume that previous step was exact, i.e., we assume <span class="math notranslate nohighlight">\(y_i = y(x_i) = \hat{y_i}\)</span> exactly.
Then the local truncation error for the first method is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
l_{i+1} = y(x_{i+1}) - y_i - h\phi_1(x_i, y_i, h) 
= y(x_{i+1}) - y_{i+1}
\end{equation*}\]</div>
<p>while the local truncation error for the second method is</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\hat{l_{i+1}} = y(x_{i+1}) - \hat{y_i} - h\phi_1(x_i, \hat{y_i}, h) 
= y(x_{i+1}) - \hat{y_{i+1}},
\end{equation*}\]</div>
<p>and so</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
l_{i+1} = \hat{l_{i+1}} + (\hat{y_{i+1}} - y_{i+1}).
\end{equation*}\]</div>
<p>However, since <span class="math notranslate nohighlight">\(l_{i+1} = O(h^{p+1})\)</span> and <span class="math notranslate nohighlight">\(\hat{l_{i+1}} = O(h^{p+2})\)</span>, it is reasonable to assume that the local truncation error for the first (lower order) method</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
l_{i+1}\approx \hat{y_{i+1}} - y_{i+1}
\end{equation*}\]</div>
<p>when <span class="math notranslate nohighlight">\(h\)</span> is small.</p>
</section>
<section id="controlling-error">
<h2>Controlling error.<a class="headerlink" href="#controlling-error" title="Link to this heading">#</a></h2>
<p>Treating the truncation error as a function of <span class="math notranslate nohighlight">\(h\)</span>, we assume that <span class="math notranslate nohighlight">\(l_{i+1}(h) \approx K h^{p+1}\)</span> for some constant <span class="math notranslate nohighlight">\(K\)</span>.
Suppose then that we are willing to adjust the step size from <span class="math notranslate nohighlight">\(h\)</span> to <span class="math notranslate nohighlight">\(\delta h\)</span> so as to keep the average local truncation error under some tolerance <span class="math notranslate nohighlight">\(\epsilon\)</span>, i.e., we want to choose <span class="math notranslate nohighlight">\(\delta\)</span> so that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\left|\frac{l_{i+1}(\delta h)}{\delta h}\right|\le \epsilon.
\end{equation*}\]</div>
<p>Observing that our assumptions imply that</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
l_{i+1}(\delta h) \approx K(\delta h)^{p+1} \approx \delta^{p+1} l_{i+1}(h) \approx \delta^{p+1}|\hat{y_{i+1}} - y_{i+1}|
\end{equation*}\]</div>
<p>and solving for <span class="math notranslate nohighlight">\(\delta\)</span>, we have</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\delta\le \left(\frac{\epsilon h}{|\hat{y_{i+1}} - y_{i+1}|}\right)^{1/p}.
\end{equation*}\]</div>
<p>In practice, <span class="math notranslate nohighlight">\(\delta\)</span> is usually chosen somewhat more conservatively since there is a “work” penalty to be paid every time that the step has to be repeated with a smaller step-size.</p>
</section>
<section id="advantages-and-disadvantages">
<h2>Advantages and disadvantages.<a class="headerlink" href="#advantages-and-disadvantages" title="Link to this heading">#</a></h2>
<p>An adaptive method offers the advantage of being able to estimate the local truncation error at each step of the algorithm and adjust the step size <span class="math notranslate nohighlight">\(h_i\)</span> to control the estimated error.
The major disadvantages are that adaptive methods are typically more computationally expensive, and they are typically much harder to implement than non-adaptive methods.</p>
</section>
<section id="rungekuttafehlberg-and-dormandprince">
<h2>Runge–Kutta–Fehlberg and Dormand–Prince.<a class="headerlink" href="#rungekuttafehlberg-and-dormandprince" title="Link to this heading">#</a></h2>
<p>One popular adaptive method employing this scheme is the <strong>Runge-Kutta-Fehlberg method (RKF45)</strong>, which uses a 4th order Runge-Kutta method (but not <em>the</em> RK4) together with a 5th order Runge-Kutta method to estimate and control the error.
The two methods were chosen so as to share as many of the evaluations of the right-hand side <span class="math notranslate nohighlight">\(f(x,y)\)</span> as possible.
In general, an order 4 method requires 4 functional evaluations and an order 5 method requires another 6 for a total of 10.
The RKF45 method, however, requires only 6 total.</p>
<p>The <strong>Dormand–Prince method</strong> works similarly to RKF45, employing a different pair of 4th and 5th order Runge–Kutta formulas, but with the roles of the two methods reversed.
It is a “method of choice” available in several “off-the-shelf” libraries.
For example, it is implemented in SciPy under the name <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.RK45.html#id1">RK45</a>.</p>
</section>
<section id="example">
<h2>Example.<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>As an example, we consider a two-body gravitational orbit problem which takes the form</p>
<div class="math notranslate nohighlight" id="equation-two-body-problem">
<span class="eqno">(27)<a class="headerlink" href="#equation-two-body-problem" title="Link to this equation">#</a></span>\[\begin{split}\ddot{\boldsymbol{r}} &amp;= -\frac{\hat{\boldsymbol{r}}}{|\boldsymbol{r}|^2},\\
\boldsymbol{r}(0) &amp; = \langle 1-e, 0\rangle,\\
\dot{\boldsymbol{r}}(0) &amp;= \left\langle 0, \sqrt{\frac{(1+e)}{(1-e)}}\right\rangle,\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol r\)</span> represents the position (or radial) vector of one body relative to the other and we denote time-derivatives with the usual dot notation.
The initial conditions ensure that the orbit will have eccentricity <span class="math notranslate nohighlight">\(e\)</span>.</p>
<p>Since IVP <a class="reference internal" href="#equation-two-body-problem">(27)</a> is a second-order problem, we introduce the auxillary vector <span class="math notranslate nohighlight">\(\boldsymbol w = \langle \boldsymbol r,  \boldsymbol v\rangle\)</span>, where <span class="math notranslate nohighlight">\(\boldsymbol v = \dot{\boldsymbol r}\)</span> is the velocity vector for one body relative to the other.
We then rewrite the second-order ODE as the first-order ODE</p>
<div class="math notranslate nohighlight" id="equation-1st-order-vector-ode">
<span class="eqno">(28)<a class="headerlink" href="#equation-1st-order-vector-ode" title="Link to this equation">#</a></span>\[\begin{split}\dot{\boldsymbol w} 
=\begin{pmatrix}\dot{\boldsymbol r}\\ \dot{\boldsymbol v}\end{pmatrix}
=\begin{pmatrix}\boldsymbol v \\ -\frac{\hat{\boldsymbol{r}}}{|\boldsymbol{r}|^2}\end{pmatrix}.\end{split}\]</div>
<p>Since we may assume that both bodies reside in a common plane, we may write
<span class="math notranslate nohighlight">\(\boldsymbol w = \langle w_0, w_1, w_2, w_3\rangle\)</span>, where</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\boldsymbol r &amp;= \langle x, y\rangle = \langle w_0, w_1\rangle,\\
\boldsymbol v &amp;= \langle \dot x, \dot y\rangle = \langle w_2, w_3\rangle.
\end{align*}\]</div>
<p>We then rewrite the vector ODE <a class="reference internal" href="#equation-1st-order-vector-ode">(28)</a> as the scalar system</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\dot{w_0} &amp;= w_2,\\
\dot{w_1} &amp;= w_3,\\
\dot{w_2} &amp;= -w_0/(w_0^2+w_1^2)^{3/2},\\
\dot{w_3} &amp;= -w_1/(w_0^2+w_1^2)^{3/2},\\
\end{align*}\]</div>
<p>We now numerically solve this problem over the time-interval <span class="math notranslate nohighlight">\([0, 10]\)</span> using SciPy’s implementation of the Dormand-Prince method for the case when the eccentricity <span class="math notranslate nohighlight">\(e = 0.9\)</span>.
With the default settings, the implementation aims to keep the estimated relative error below <span class="math notranslate nohighlight">\(10^{-3}\)</span> and the estimated absolute error below <span class="math notranslate nohighlight">\(10^{-6}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import modules</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<span class="kn">import</span> <span class="nn">math263</span>

<span class="c1"># define IVP parameters</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
        <span class="o">-</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">w0</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="p">))])</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span>

<span class="n">pyplot</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;dark_background&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>

<span class="c1"># numerically solve IVP with Dormand-Prince (RK45)</span>
<span class="n">dp54_soln</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">w0</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;RK45&quot;</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">10</span><span class="o">**-</span><span class="mi">6</span><span class="p">)</span>
<span class="k">if</span> <span class="n">dp54_soln</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dormand-Prince method failed.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dormand-Prince method successfully reached end of time span.&quot;</span><span class="p">)</span>
    <span class="n">ti</span> <span class="o">=</span> <span class="n">dp54_soln</span><span class="o">.</span><span class="n">t</span>
    <span class="c1"># extract time-steps</span>
    <span class="n">wi</span> <span class="o">=</span> <span class="n">dp54_soln</span><span class="o">.</span><span class="n">y</span>
    <span class="n">ri</span> <span class="o">=</span> <span class="n">wi</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># extract radial vectors</span>
    <span class="n">vi</span> <span class="o">=</span> <span class="n">wi</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1"># extract velocity vectors</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ti</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End of time-interval [</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2">] reached in n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> time-steps.&quot;</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Displaying results for first </span><span class="si">{</span><span class="n">T</span><span class="si">}</span><span class="s2"> steps.&quot;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">ti</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span> <span class="n">ri</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">T</span><span class="p">],</span> <span class="n">ri</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="n">T</span><span class="p">],</span> <span class="n">vi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="n">T</span><span class="p">],</span> <span class="n">vi</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="n">T</span><span class="p">]]</span>
    <span class="n">hdrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;t_i&quot;</span><span class="p">,</span> <span class="s2">&quot;x_i&quot;</span><span class="p">,</span> <span class="s2">&quot;y_i&quot;</span><span class="p">,</span> <span class="s2">&quot;x_i&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;y_i&#39;&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">hdrs</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;0.5f&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;mixed_grid&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting solution in spatial domain (xy-plane).&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;wo&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mass 0&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ri</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ri</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Mass 1 (DP54 solution)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">r</span><span class="s2">&quot;$\ddot{\boldsymbol</span><span class="si">{r}</span><span class="s2">} = -\frac{\hat{\boldsymbol</span><span class="si">{r}</span><span class="s2">}}{r^2},\quad \boldsymbol</span><span class="si">{r}</span><span class="s2">(0) = \langle 0.1, 0\rangle$&quot;</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$x$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$y$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dormand-Prince method successfully reached end of time span.
End of time-interval [0, 10] reached in n = 76 time-steps.
Displaying results for first 10 steps.
┍━━━━━┯━━━━━━━━━┯━━━━━━━━━━┯━━━━━━━━━┯━━━━━━━━━━┯━━━━━━━━━┑
│   i │     t_i │      x_i │     y_i │     x_i&#39; │    y_i&#39; │
┝━━━━━┿━━━━━━━━━┿━━━━━━━━━━┿━━━━━━━━━┿━━━━━━━━━━┿━━━━━━━━━┥
│   0 │ 0.00000 │  0.10000 │ 0.00000 │  0.00000 │ 4.35890 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   1 │ 0.00643 │  0.09796 │ 0.02785 │ -0.62732 │ 4.27146 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   2 │ 0.01264 │  0.09238 │ 0.05372 │ -1.15321 │ 4.04799 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   3 │ 0.01963 │  0.08264 │ 0.08087 │ -1.60459 │ 3.70439 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   4 │ 0.02771 │  0.06820 │ 0.10906 │ -1.94517 │ 3.28108 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   5 │ 0.03705 │  0.04889 │ 0.13757 │ -2.16169 │ 2.83304 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   6 │ 0.04790 │  0.02475 │ 0.16589 │ -2.26905 │ 2.40325 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   7 │ 0.06067 │ -0.00445 │ 0.19395 │ -2.29356 │ 2.01212 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   8 │ 0.07587 │ -0.03913 │ 0.22179 │ -2.25928 │ 1.66619 │
├─────┼─────────┼──────────┼─────────┼──────────┼─────────┤
│   9 │ 0.09417 │ -0.07980 │ 0.24936 │ -2.18500 │ 1.36548 │
┕━━━━━┷━━━━━━━━━┷━━━━━━━━━━┷━━━━━━━━━┷━━━━━━━━━━┷━━━━━━━━━┙
Plotting solution in spatial domain (xy-plane).
</pre></div>
</div>
<img alt="_images/01e9258b2784273a9e7cefd4671d5e53c85dd4bdca5f43ff9b5cd0ebeff2c882.png" src="_images/01e9258b2784273a9e7cefd4671d5e53c85dd4bdca5f43ff9b5cd0ebeff2c882.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="08-higher_order_odes.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">8: Higher order initial value problems.</p>
      </div>
    </a>
    <a class="right-next"
       href="10-shooting_method.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">10: Boundary value problems and the shooting method.</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-unknown">Estimating the unknown.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controlling-error">Controlling error.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages-and-disadvantages">Advantages and disadvantages.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rungekuttafehlberg-and-dormandprince">Runge–Kutta–Fehlberg and Dormand–Prince.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example.</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Ethan Smith
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>